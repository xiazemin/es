**ElasticSearch运维手册**

在管理es集群时，我们可以直接向es安装所在服务器9200端口\(默认端口\)发送请求查看查询结果。也可使用Cerebro可视化管理工具对es进行管理。

**1. ElasticSearch管理工具**  
通过 GET 请求发送 cat 命名可以列出所有可用的cat API，我们可以使用postman或者浏览器发送请求到es的9200端口。

![](https://img2018.cnblogs.com/blog/907596/201907/907596-20190725105026159-1479466021.png)

查询结果如下，请求返回了所有可用的cat API

![](https://img2018.cnblogs.com/blog/907596/201907/907596-20190725105131697-1765157879.png)

又或者可以使用**Cerebro可视化管理工具**对es进行管理。比如我的管理工具访问地址http://172.16.60.14:9002/\#/connect

![](https://img2018.cnblogs.com/blog/907596/201907/907596-20190725105711933-775267779.png)

如下图所示，进入到可视化管理界面以后，选择顶部导航菜单more,在下拉选项框中选择cat apis。

![](https://img2018.cnblogs.com/blog/907596/201907/907596-20190725105532914-735373857.png)

进入cat api查询页面

![](https://img2018.cnblogs.com/blog/907596/201907/907596-20190725105747498-999117060.png)

![](https://img2018.cnblogs.com/blog/907596/201907/907596-20190725105812085-1084241060.png)

**2. 常用cat API介绍**

**1.**健康检查  
/\_cat/health 和 /\_cat/health?v     查询请求带了?v 将返回表头，在postman中我们可以发起如下请求，可以看到es集群的健康状况，但是结果并不直观。



![](https://img2018.cnblogs.com/blog/907596/201907/907596-20190725110018274-1217190598.png)

![](https://img2018.cnblogs.com/blog/907596/201907/907596-20190725110041122-1062100970.png)

通过es管理工具很方便的就能使用cat api,下拉框中选中health

![](https://img2018.cnblogs.com/blog/907596/201907/907596-20190725110108318-895015292.png)

点击excute按钮即可对需要管理的es集群进行健康检查。

![](https://img2018.cnblogs.com/blog/907596/201907/907596-20190725110147677-665607735.png)

![](https://img2018.cnblogs.com/blog/907596/201907/907596-20190725110218170-1977835826.png)

**2.**节点分片数量查询  
/\_cat/allocation?v

![](https://img2018.cnblogs.com/blog/907596/201907/907596-20190725110332363-1004858091.png)

查询每个节点上分配的分片（shard）的数量和每个分片（shard）所使用的硬盘容量

**3.**节点统计  
/\_cat/nodes 或/\_cat/nodes?v

![](https://img2018.cnblogs.com/blog/907596/201907/907596-20190725110416481-770745508.png)

显示当前es集群节点的状况。

**4. **文档数量查询  
/\_cat/count?v

![](https://img2018.cnblogs.com/blog/907596/201907/907596-20190725110501387-2083451823.png)

快速查询当前集群document数量

**5.**查询master节点  
/\_cat/master?v

![](https://img2018.cnblogs.com/blog/907596/201907/907596-20190725110548748-340501289.png)

用于显示master的节点ID，绑定IP地址，节点名称。

**6.**查询节点自定义属性  
/\_cat/nodeattrs?v

![](https://img2018.cnblogs.com/blog/907596/201907/907596-20190725110638847-38663585.png)

显示节点自定义属性。

**7.**执行任务查询  
/\_cat/pending\_tasks?v

![](https://img2018.cnblogs.com/blog/907596/201907/907596-20190725110746904-1529004002.png)

**8.**索引分片恢复查询  
/\_cat/recovery?v

![](https://img2018.cnblogs.com/blog/907596/201907/907596-20190725110832566-1994986819.png)

索引分片正在恢复或者已经完成恢复的相关信息。

**9.**节点线程查询  
/\_cat/thread\_pool

![](https://img2018.cnblogs.com/blog/907596/201907/907596-20190725110921042-1293498780.png)

输出每个节点的线程池统计信息，默认情况下显示正在活动、队列和被拒绝的统计信息。

**10.**索引所在分片查询  
/\_cat/shards

![](https://img2018.cnblogs.com/blog/907596/201907/907596-20190725111007828-553867650.png)

输出节点包含分片的详细信息（当前分片是primary shard还是 replica shard，doc的数量，硬盘上占用的字节已经该节点被分配在哪里等）。

